{% extends "base.html" %}
{% block pagecontent %}
	<br/>
	<style>
	td{border-top: 0px !important;font-size:14px; }
	.roundBorder,td div{border:1px solid #000000; border-radius:8px;box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.4) inset, 0 1px 10px rgba(0, 0, 0, 0.4);}
	.negative{border:1px solid #FF0000 !important;padding:0 20px 0 20px;}
	.positive{border:1px solid #00FF00 !important;padding:0 20px 0 20px;}
	.rightAlign{text-align:right !important;}
	.fontBold{font-weight:Bold;font-size:14px !important;}
	.colortd{background:#dadada;font-weight:Bold;font-size:14px;}
	.fontSize{font-size:14px !important;}
	</style>
<script>
$(function(){

 	tips = $( ".validateTips" );
	 flag=true;
	function updateTips( t ) {
		flag=false;
		tips
		.text( t )
		.addClass( "ui-state-highlight" );
		setTimeout(function() {
		tips.removeClass( "ui-state-highlight", 1500 );
		}, 500 );
	}
	$( "#dialog-form" ).dialog({
			autoOpen: false,
			height: 400,
			width: 500,
			modal: true,
			buttons: {
				"Edit": function() {
					var data="";
					flag=true;
					$( "#dialog-form input").removeClass( "ui-state-error" );
					$( "#dialog-form textArea[name=options]" ).each(function( index ) {
						if($(this).val()!='' && $(this).parent().find('input[name=spinner]').val()!='')
							data = data + $(this).val()+'|'+$(this).parent().find('input[name=spinner]').val() +',';
					});
					data = data.slice(0,-1);
					$("#dialog-form input[name=option_text]").val(data);
					if(data=='')
					{
						updateTips('Enter options');
						$( "#dialog-form textArea[name=options]").addClass( "ui-state-error" );
					}
					
					if($("#dialog-form *[name=option_header_text]").val()=="")
					{
						updateTips('Enter option header');
						$( "#dialog-form *[name=option_header_text]").addClass( "ui-state-error" );
					}
					else
					{
						data={'search_txt':'Validate','stitle':$("#dialog-form *[name=option_header_text]").val(),'nOptionHeaderID':$('#dialog-form').find("input[name=option_header_id]").val()};
						AjaxEvent(data, '/question/validateOptionHeader/',function(data, textStatus, jqXHR){
											var response=jQuery.parseJSON(data);
											if(response.error != '')
											{
												updateTips(response.error);
											}
											else
											{
												if(flag)
												{
													data={'search_txt':'Validate','option_header_text':$("#dialog-form *[name=option_header_text]").val(),'option_header_id':$('#dialog-form').find("input[name=option_header_id]").val(),
													'option_text':$("#dialog-form input[name=option_text]").val()
													};
													
													AjaxEvent(data, '/question/updateOption/',function(data, textStatus, jqXHR){
																		var response=jQuery.parseJSON(data);
																		if(response.success != '')
																		{
																			alert(response.success);
																			$( "#dialog-form" ).dialog( "close" );
																			$("#hrefUserExisting").trigger('click');
																		}	
																	},null);
												}
											}
										},null);
					}
					
					
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
			},
			close: function() {
				$( "#dialog-form input").removeClass( "ui-state-error" );
			}
	});	
	
	$("*[name=OthersDetails]").click(function(event){
		nSelectedQuestion = $(this).attr('value');
		nSelectedUserID = $('*[name=drpUser] option:selected').attr('value');
		data={'search_txt':'Validate','UserID':nSelectedUserID,'QuestionID':nSelectedQuestion};
		AjaxEvent(data, '/reports/IndividualQuestion/',function(data, textStatus, jqXHR){
									var response=jQuery.parseJSON(data);
			
							        for (var i=0;i<response.length;i++) {
									            $('#divModalContainer table').append("<tr value="+response[i].AppraisalContentID+">"+
				"<td><input type=\"checkbox\" name=\"chkRecordCheck\"/></td>"+
				"<td><label name=\"lblUserSelection\">"+response[i].answer+"</label></td>"+
				"<td><label name=\"lblUserName\">"+response[i].UserName+"</label></td>"+
				"<td></td>"+
			"</tr>");				            
			}
								},null);
	
	
	$( "#dialog-form" ).dialog( "open" );
	});
	
});

</script>
	
<div style="padding-left:30px;padding-right:30px;">
	<div style="padding:30px;border:2px solid;width:70%;border-radius:20px;background:#ffffff">
		<legend style="text-align:center">Report</legend>
		
		<div>
		{% if UserList%}
		<form method="post">{% csrf_token %}
		<select name="drpUser">
			<option value="0">-- Please Select -- </option>
			{% for user in UserList%}
				{% if user.user_id == drpUser%}
					<option value="{{user.user_id}}" selected="true">{{user.firstname}}</option>
				{%else%}
					<option value="{{user.user_id}}">{{user.firstname}}</option>
				{%endif%}
			{%endfor%}
		</select>
		<input type="Submit" value="Fetch" class="btn btn-inverse"/>
		</form>
		{%endif%}
		</div>	
		{% if error %}
		<div class="alert alert-error">{{error}}</div>
		{% endif%}
		{% if reports%}
		<table class="table" width="100%">
			<thead>
				<tr style="background:#dadada;box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.4) inset, 0 1px 15px rgba(0, 0, 0, 0.4);">
					<th  width="40%" style="padding-left:40px;">Quality</th>
					<th  width="15%" class="rightAlign">Self-assessment</th>
					<th  width="15%" class="rightAlign">Others(Average)</th>
					<th  width="15%" class="rightAlign" style="padding-right:40px;">Difference</th>
				</tr>
			</thead>
			
			<tbody>
			{% for objReport in reports %}
				{% if objReport.status == 'Scale' %}
					<tr  style="padding:10px;padding-bottom:20px;">
						<td colspan="5">
							{%if objReport.answerYourself <= objReport.answerOther%}
								<div class="positive">
							{%else%}
								<div class="negative">
							{%endif%}
							<table  width="100%">
								<tr>	
									<td  width="40%" colspan="2"><label  class="fontBold">{{objReport.header}}</label></td>
									<td  width="15%" class="rightAlign">{{objReport.answerYourself}}</td>
									<td  width="15%" class="rightAlign">
										{%if type == 'Administrator'%}
											<a name="OthersDetails" href="#" value="{{objReport.questionID}}">
										{%endif%}
											{{objReport.answerOther}}
										{%if type == 'Administrator'%}
											</a>
										{%endif%}
										</td>
									<td  width="15%" class="rightAlign">{{objReport.total}}</td>
								</tr>
							</table>
							</div>	
						</td>
					</tr>
				{% endif %}
				{% if objReport.status == 'MCQ' %}
					<tr style="padding:10px;padding-bottom:20px;">
						<td colspan="5">
						{%if objReport.mcqSelfCount <= objReport.mcqOtherCount%}
								<div class="positive">
							{%else%}
								<div class="negative">
							{%endif%}
								<table width="100%">
									<tr>
										<td  width="100%" ><label  class="fontBold">{{objReport.header}}</label></td>
										<td class="rightAlign">{{objReport.total}}</td>
									</tr>
									<tr>
										<td colspan="2">
											<table width="100%">
												{% for option in objReport.options %}
														<tr>
															<td width="40%" style="border-top: 0px"><label>{{option.option_text}}</label></td>
													
															{% if objReport.answerYourself == option.option_id %}
																<td width="15%" class="rightAlign" style="border-top: 0px;"><i class="icon-ok"></i></td>
															{% else %}
																<td width="15%" class="rightAlign" style="border-top: 0px;"><label>&nbsp;</label></td>
															{% endif %}
													
															{% if option.option_count == 0 %}
																<td width="15%" class="rightAlign" style="border-top: 0px;"><label>&nbsp;</label></td>
															{% else %}
																<td width="15%" class="rightAlign" style="border-top: 0px;">
																{%if type == 'Administrator'%}
																	<a name="OthersDetails" href="#" value="{{objReport.questionID}}">
																{%endif%}
																{{option.option_count}}
																{%if type == 'Administrator'%}
																	</a>
																{%endif%}
																
																</td>
															{% endif %}
															<td width="15%">&nbsp;</td>
														</tr>
												{% endfor %}
												
											</table>
										</td>
									</tr>
								</table>
							</div>	
						</td>
					</tr>
				{% endif %}
			{% endfor %}
			
			
			
			<tr><td><br/>
			<legend style="margin-bottom:5px !important;">Index</legend>
				<table class="roundBorder">
					<tr>
						<td width="50%" class="colortd" >Maximun Possible</td>
						<td style="padding-right:20%;" class="rightAlign">100.00</td>
					</tr>
					<tr>
						<td class="colortd">Self-Appraisal</td>
						<td style="padding-right:20%;" class="rightAlign">{{selfTotal|floatformat:"2"}}</td>
					</tr>
					<tr>
						<td class="colortd">Others</td>
						<td style="padding-right:20%;" class="rightAlign">{{othersTotal|floatformat:"2"}}</td>
					</tr>
			
				</table>
			</td></tr>
			<tr style="padding:10px;padding-bottom:20px;">
				<td colspan="4">
					<br/><br/>
					 <legend style="margin-bottom:0px;">Comments</legend> 
				</td>
			</tr>
			{% for objReport in reports %}
				{% if objReport.status == 'Subjective' %}
					<tr  style="padding:10px;padding-bottom:20px;">
						<td  width="40%" colspan="4">
							<div>
							<table width="100%">
								<tr style="background:#dadada"><td class="fontBold">{{objReport.header}}</td></tr>
								<tr><td><label class="fontBold">Yourself :</label> <label class="fontSize">{{objReport.answerYourself}}</label></td></tr>
								<tr><td><label class="fontBold">Others : </label><label class="fontSize">{{objReport.answerOther|linebreaksbr}}</label></td></tr>
							</table>
							</div>
						</td>
					</tr>
				{% endif %}
			{% endfor %}
			</tbody>	
		</table>
		{%endif%}
		
	</div>
	
	
	
	
	<div id="dialog-form" title="Edit Options" style="font-size:15px;">
 	<p class="validateTips fontSize"></p>
	<form>
	<fieldset>
		<div id="divModalContainer">
			List of appraiser answer to the selected user
			<table width="100%" class="table">
			
			</table>
		
		
		</div>
	</fieldset>
	</form>
</div>
</div>
	
	
{% endblock %}
